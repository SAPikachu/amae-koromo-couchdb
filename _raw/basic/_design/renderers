{
  "_id": "_design/renderers",
  "_rev": "158-08b8ebb36b5eb25f9aa4ee4fe503235f",
  "views": {
    "lib": {
      "convert_extended_stats": "exports.func = function func(value) {\n\tvar buildFans = require(\"views/lib/build_fans\");\n\tvar result = {\n\t\tcount: value.count,\n\t\t和牌率: value.和 / value.count,\n\t\t自摸率: value.自摸 / value.和,\n\t\t默听率: value.默听 / value.和,\n\t\t放铳率: value.放铳 / value.count,\n\t\t副露率: value.副露 / value.count,\n\t\t立直率: value.立直 / value.count,\n\t\t平均打点: Math.round(value.和了点数 / value.和 * 100),\n\t\t最大连庄: value.最大连庄,\n\t\t和了巡数: value.和了巡数 / value.和,\n\t\t平均铳点: Math.round(value.放铳点数 / value.放铳 * 100),\n\t\t流局率: value.流局 / value.count,\n\t\t流听率: value.流局听牌 / value.流局,\n\t\t一发率: value.一发 / value.立直和了,\n\t\t里宝率: value.里宝 / value.立直和了,\n\t\t被炸率: value.被炸 / value.被自摸,\n\t\t平均被炸点数: Math.round(value.被炸点数 / value.被炸 * 100),\n\t\t放铳时立直率: value.放铳时立直 / value.放铳,\n\t\t放铳时副露率: value.放铳时副露 / value.放铳,\n\t\t立直后放铳率: value.放铳时立直 / value.立直,\n\t\t立直后非瞬间放铳率: (value.放铳时立直 - (value.立直瞬间放铳 || 0)) / value.立直,\n\t\t副露后放铳率: value.放铳时副露 / value.副露,\n\t\t立直后和牌率: value.立直和了 / value.立直,\n\t\t副露后和牌率: value.副露和了 / value.副露,\n\t\t立直后流局率: value.立直流局 / value.立直,\n\t\t副露后流局率: value.副露流局 / value.副露,\n\t\t放铳至立直: value.放铳至立直,\n\t\t放铳至副露: value.放铳至副露,\n\t\t放铳至默听: value.放铳至默听,\n\t\t立直和了: value.立直和了,\n\t\t副露和了: value.副露和了,\n\t\t默听和了: value.默听,\n\t\t立直巡目: value.立直巡目 / value.立直,\n\t\t立直收支: Math.round(((value.立直收入 || 0) - (value.立直支出 || 0) + (value.立直流局收支 || 0) + (value.立直其它收支 || 0)) * 100 / value.立直),\n\t\t立直收入: Math.round(value.立直收入 * 100 / value.立直和了),\n\t\t立直支出: Math.round(value.立直支出 * 100 / value.放铳时立直),\n\t\t先制率: value.先制立直 / value.立直,\n\t\t追立率: value.追立 / value.立直,\n\t\t被追率: value.被追立 / value.立直,\n\t\t振听立直率: (value.振听立直 || 0) / value.立直,\n\t\t立直好型: (value.立听好型 || 0) / value.立听分母,\n\t\t立直多面: (value.立听好型 || 0) / value.立听分母,\n\t\t立直好型2: (value.立听好型2 || 0) / value.立残分母,\n\t\t役满: value.役满,\n\t\t累计役满: value.累计役满,\n\t\t最大累计番数: value.最大累计番数,\n\t\tW立直: value.W立直,\n\t\t流满: value.流满,\n\t\t打点效率: Math.round((value.和 / value.count) * (value.和了点数 / value.和 * 100)),\n\t\t铳点损失: Math.round((value.放铳 / value.count) * (value.放铳点数 / value.放铳 * 100)),\n\t\t净打点效率: Math.round((value.和 / value.count) * (value.和了点数 / value.和 * 100) - (value.放铳 / value.count) * (value.放铳点数 / value.放铳 * 100)),\n\t\t平均起手向听: value.起手向听 / value.count,\n\t\t最近大铳: value.最近大铳 ? {\n\t\t\tid: value.最近大铳[3],\n\t\t\tstart_time: value.最近大铳[4],\n\t\t\tfans: buildFans(value.最近大铳[1]),\n\t\t} : undefined,\n\t};\n\treturn result;\n}",
      "convert_level": "exports.func = function(value) {\n\treturn {\n\t\tid: value[0],\n\t\tscore: value[1],\n\t\tdelta: value[2],\n\t};\n}",
      "player_stats": "exports.func = function(value) {\n\t\"use strict\";\n\tvar convert_level = require(\"views/lib/convert_level\").func;\n\tvar ranks = value.accum.slice(0, 4);\n\tvar result = {\n\t\tcount: sum(ranks),\n\t\tlevel: value.level && convert_level(value.level),\n\t\tranking_level: value.ranking_level && convert_level(value.ranking_level),\n\t\tmax_level: value.max_level && convert_level(value.max_level),\n\t};\n\tif (result.level && Math.floor(result.level.id / 10000) === 2) {\n\t\tranks = ranks.slice(0, 3);\n\t}\n\tresult.rank_rates = ranks.map(function(x) {\n\t\treturn x / result.count;\n\t});\n\tif (value.score_accum) {\n\t\tresult.rank_avg_score = value.score_accum.slice(0, ranks.length).map(function(x, i) {\n\t\t\treturn Math.round(x / ranks[i] * 100);\n\t\t});\n\t}\n\tresult.avg_rank = sum(ranks.map(function(x, index) {\n\t\treturn x * (index + 1);\n\t})) / result.count;\n\tresult.negative_rate = value.accum[4] / result.count;\n\treturn result;\n}",
      "resp_utils": "module.exports = {\n\tprepare_response: function (req, maxage, code) {\n\t  \"use strict\";\n\t\tmaxage = maxage || 60;\n\t\tcode = code || 200;\n\t\tif (req && req.query && req.query.maxage) {\n\t\t\tmaxage = req.query.maxage;\n\t\t}\n\t\treturn {\n\t\t\tcode: code,\n\t\t\theaders: {\n\t\t\t\t\"Cache-Control\": \"public, max-age=\" + maxage + \", stale-while-revalidate=\" + maxage + \", stale-if-error=\" + maxage,\n\t\t\t\t\"Vary\": \"Origin\",\n      \t\"Content-Type\" : \"application/json; charset=utf-8\",\n\t\t\t}\n\t\t};\n\t},\n  start_response: function (req, maxage, code) {\n\t  \"use strict\";\n\t\tstart(module.exports.prepare_response(req, maxage, code));\n\t},\n  build_response: function (req, body, maxage, code) {\n\t  \"use strict\";\n\t\tvar result = module.exports.prepare_response(req, maxage, code);\n\t\tresult.body = toJSON(body);\n\t\treturn result;\n\t},\n\terror: function (e, maxage, code) {\n\t  \"use strict\";\n\t\tmaxage = maxage || 3600;\n\t\tcode = code || 400;\n\t\tmodule.exports.start_response(null, maxage, code);\n\t\treturn toJSON(e);\n\t},\n\treduce_rows: function(req, reducer, final_reducer, initial, validate_key) {\n\t\tvar row = getRow();\n\t\tif (!row) {\n\t\t\treturn this.error({error: \"no_row_returned\"}, 3600, 404);\n\t\t}\n\t\tif (validate_key) {\n\t\t\tvar e = validate_key(row.key);\n\t\t\tif (e) {\n\t\t\t\treturn e;\n\t\t\t}\n\t\t}\n\t\tmodule.exports.start_response(req);\n\t\tvar state = initial;\n\t\twhile (row) {\n\t\t\tstate = reducer(row, state);\n\t\t\trow = getRow();\n\t\t}\n\t\tif (final_reducer) {\n\t\t\tstate = final_reducer(state);\n\t\t}\n\t\treturn toJSON(state);\n\t},\n};",
      "fan": "module.exports = {\n  \"1\": {\n    \"id\": 1,\n    \"name_chs\": \"门前清自摸和\",\n    \"name_jp\": \"門前清自摸和\",\n    \"name_en\": \"Fully Concealed Hand\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 70,\n    \"sound\": \"fan_zimo\",\n    \"is_guyi\": 0\n  },\n  \"2\": {\n    \"id\": 2,\n    \"name_chs\": \"立直\",\n    \"name_jp\": \"立直\",\n    \"name_en\": \"Riichi\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 10,\n    \"sound\": \"fan_liqi\",\n    \"is_guyi\": 0\n  },\n  \"3\": {\n    \"id\": 3,\n    \"name_chs\": \"枪杠\",\n    \"name_jp\": \"槍槓\",\n    \"name_en\": \"Robbing a Kan\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 30,\n    \"sound\": \"fan_qianggang\",\n    \"is_guyi\": 0\n  },\n  \"4\": {\n    \"id\": 4,\n    \"name_chs\": \"岭上开花\",\n    \"name_jp\": \"嶺上開花\",\n    \"name_en\": \"After a Kan\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 40,\n    \"sound\": \"fan_lingshang\",\n    \"is_guyi\": 0\n  },\n  \"5\": {\n    \"id\": 5,\n    \"name_chs\": \"海底摸月\",\n    \"name_jp\": \"海底摸月\",\n    \"name_en\": \"Under the Sea\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 50,\n    \"sound\": \"fan_haidi\",\n    \"is_guyi\": 0\n  },\n  \"6\": {\n    \"id\": 6,\n    \"name_chs\": \"河底捞鱼\",\n    \"name_jp\": \"河底撈魚\",\n    \"name_en\": \"Under the River\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 60,\n    \"sound\": \"fan_hedi\",\n    \"is_guyi\": 0\n  },\n  \"7\": {\n    \"id\": 7,\n    \"name_chs\": \"役牌 白\",\n    \"name_jp\": \"役牌 白\",\n    \"name_en\": \"White Dragon\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 120,\n    \"sound\": \"fan_bai\",\n    \"is_guyi\": 0\n  },\n  \"8\": {\n    \"id\": 8,\n    \"name_chs\": \"役牌 发\",\n    \"name_jp\": \"役牌 發\",\n    \"name_en\": \"Green Dragon\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 130,\n    \"sound\": \"fan_fa\",\n    \"is_guyi\": 0\n  },\n  \"9\": {\n    \"id\": 9,\n    \"name_chs\": \"役牌 中\",\n    \"name_jp\": \"役牌 中\",\n    \"name_en\": \"Red Dragon\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 140,\n    \"sound\": \"fan_zhong\",\n    \"is_guyi\": 0\n  },\n  \"10\": {\n    \"id\": 10,\n    \"name_chs\": \"役牌:门风牌\",\n    \"name_jp\": \"役牌:自風牌\",\n    \"name_en\": \"Seat Wind\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 150,\n    \"sound\": \"\",\n    \"is_guyi\": 0\n  },\n  \"11\": {\n    \"id\": 11,\n    \"name_chs\": \"役牌:场风牌\",\n    \"name_jp\": \"役牌:場風牌\",\n    \"name_en\": \"Prevalent Wind\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 160,\n    \"sound\": \"\",\n    \"is_guyi\": 0\n  },\n  \"12\": {\n    \"id\": 12,\n    \"name_chs\": \"断幺九\",\n    \"name_jp\": \"断幺九\",\n    \"name_en\": \"All Simples\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 170,\n    \"sound\": \"fan_duanyao\",\n    \"is_guyi\": 0\n  },\n  \"13\": {\n    \"id\": 13,\n    \"name_chs\": \"一杯口\",\n    \"name_jp\": \"一盃口\",\n    \"name_en\": \"Pure Double Sequence\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 0,\n    \"show_index\": 90,\n    \"sound\": \"fan_yibeikou\",\n    \"is_guyi\": 0\n  },\n  \"14\": {\n    \"id\": 14,\n    \"name_chs\": \"平和\",\n    \"name_jp\": \"平和\",\n    \"name_en\": \"Pinfu\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 0,\n    \"show_index\": 80,\n    \"sound\": \"fan_pinghu\",\n    \"is_guyi\": 0\n  },\n  \"15\": {\n    \"id\": 15,\n    \"name_chs\": \"混全带幺九\",\n    \"name_jp\": \"混全帯幺九\",\n    \"name_en\": \"Half Outside Hand\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 1,\n    \"show_index\": 180,\n    \"sound\": \"fan_hunquandaiyaojiu\",\n    \"is_guyi\": 0\n  },\n  \"16\": {\n    \"id\": 16,\n    \"name_chs\": \"一气通贯\",\n    \"name_jp\": \"一気通貫\",\n    \"name_en\": \"Pure Straight\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 1,\n    \"show_index\": 190,\n    \"sound\": \"fan_yiqitongguan\",\n    \"is_guyi\": 0\n  },\n  \"17\": {\n    \"id\": 17,\n    \"name_chs\": \"三色同顺\",\n    \"name_jp\": \"三色同順\",\n    \"name_en\": \"Mixed Triple Sequence\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 1,\n    \"show_index\": 200,\n    \"sound\": \"fan_sansetongshun\",\n    \"is_guyi\": 0\n  },\n  \"18\": {\n    \"id\": 18,\n    \"name_chs\": \"两立直\",\n    \"name_jp\": \"ダブル立直\",\n    \"name_en\": \"Double Riichi\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 2,\n    \"show_index\": 10,\n    \"sound\": \"fan_dliqi\",\n    \"is_guyi\": 0\n  },\n  \"19\": {\n    \"id\": 19,\n    \"name_chs\": \"三色同刻\",\n    \"name_jp\": \"三色同刻\",\n    \"name_en\": \"Triple Triplets\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 2,\n    \"show_index\": 220,\n    \"sound\": \"fan_sansetongke\",\n    \"is_guyi\": 0\n  },\n  \"20\": {\n    \"id\": 20,\n    \"name_chs\": \"三杠子\",\n    \"name_jp\": \"三槓子\",\n    \"name_en\": \"Three Quads\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 2,\n    \"show_index\": 230,\n    \"sound\": \"fan_sangangzi\",\n    \"is_guyi\": 0\n  },\n  \"21\": {\n    \"id\": 21,\n    \"name_chs\": \"对对和\",\n    \"name_jp\": \"対々和\",\n    \"name_en\": \"All Triplets\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 2,\n    \"show_index\": 240,\n    \"sound\": \"fan_duiduihu\",\n    \"is_guyi\": 0\n  },\n  \"22\": {\n    \"id\": 22,\n    \"name_chs\": \"三暗刻\",\n    \"name_jp\": \"三暗刻\",\n    \"name_en\": \"Three Concealed Triplets\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 2,\n    \"show_index\": 250,\n    \"sound\": \"fan_sananke\",\n    \"is_guyi\": 0\n  },\n  \"23\": {\n    \"id\": 23,\n    \"name_chs\": \"小三元\",\n    \"name_jp\": \"小三元\",\n    \"name_en\": \"Little Three Dragons\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 2,\n    \"show_index\": 260,\n    \"sound\": \"fan_xiaosanyuan\",\n    \"is_guyi\": 0\n  },\n  \"24\": {\n    \"id\": 24,\n    \"name_chs\": \"混老头\",\n    \"name_jp\": \"混老頭\",\n    \"name_en\": \"All Terminals and Honors\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 2,\n    \"show_index\": 270,\n    \"sound\": \"fan_hunlaotou\",\n    \"is_guyi\": 0\n  },\n  \"25\": {\n    \"id\": 25,\n    \"name_chs\": \"七对子\",\n    \"name_jp\": \"七対子\",\n    \"name_en\": \"Seven Pairs\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 2,\n    \"show_index\": 110,\n    \"sound\": \"fan_qiduizi\",\n    \"is_guyi\": 0\n  },\n  \"26\": {\n    \"id\": 26,\n    \"name_chs\": \"纯全带幺九\",\n    \"name_jp\": \"純全帯幺九\",\n    \"name_en\": \"Fully Outside Hand\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 3,\n    \"fan_fulu\": 2,\n    \"show_index\": 280,\n    \"sound\": \"fan_chunquandaiyaojiu\",\n    \"is_guyi\": 0\n  },\n  \"27\": {\n    \"id\": 27,\n    \"name_chs\": \"混一色\",\n    \"name_jp\": \"混一色\",\n    \"name_en\": \"Half Flush\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 3,\n    \"fan_fulu\": 2,\n    \"show_index\": 290,\n    \"sound\": \"fan_hunyise\",\n    \"is_guyi\": 0\n  },\n  \"28\": {\n    \"id\": 28,\n    \"name_chs\": \"二杯口\",\n    \"name_jp\": \"二盃口\",\n    \"name_en\": \"Twice Pure Double Sequence\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 3,\n    \"fan_fulu\": 0,\n    \"show_index\": 100,\n    \"sound\": \"fan_erbeikou\",\n    \"is_guyi\": 0\n  },\n  \"29\": {\n    \"id\": 29,\n    \"name_chs\": \"清一色\",\n    \"name_jp\": \"清一色\",\n    \"name_en\": \"Full Flush\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 6,\n    \"fan_fulu\": 5,\n    \"show_index\": 300,\n    \"sound\": \"fan_qingyise\",\n    \"is_guyi\": 0\n  },\n  \"30\": {\n    \"id\": 30,\n    \"name_chs\": \"一发\",\n    \"name_jp\": \"一発\",\n    \"name_en\": \"Ippatsu\",\n    \"xuanshang\": 1,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 20,\n    \"sound\": \"fan_yifa\",\n    \"is_guyi\": 0\n  },\n  \"31\": {\n    \"id\": 31,\n    \"name_chs\": \"宝牌\",\n    \"name_jp\": \"ドラ\",\n    \"name_en\": \"Dora\",\n    \"xuanshang\": 1,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 310,\n    \"sound\": \"\",\n    \"is_guyi\": 0\n  },\n  \"32\": {\n    \"id\": 32,\n    \"name_chs\": \"红宝牌\",\n    \"name_jp\": \"赤ドラ\",\n    \"name_en\": \"Red Five\",\n    \"xuanshang\": 1,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 320,\n    \"sound\": \"\",\n    \"is_guyi\": 0\n  },\n  \"33\": {\n    \"id\": 33,\n    \"name_chs\": \"里宝牌\",\n    \"name_jp\": \"裏ドラ\",\n    \"name_en\": \"Ura Dora\",\n    \"xuanshang\": 1,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 340,\n    \"sound\": \"\",\n    \"is_guyi\": 0\n  },\n  \"34\": {\n    \"id\": 34,\n    \"name_chs\": \"拔北宝牌\",\n    \"name_jp\": \"抜きドラ\",\n    \"name_en\": \"Kita\",\n    \"xuanshang\": 1,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 330,\n    \"sound\": \"\",\n    \"is_guyi\": 0\n  },\n  \"35\": {\n    \"id\": 35,\n    \"name_chs\": \"天和\",\n    \"name_jp\": \"天和\",\n    \"name_en\": \"Blessing of Heaven\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 350,\n    \"sound\": \"fan_tianhu\",\n    \"is_guyi\": 0\n  },\n  \"36\": {\n    \"id\": 36,\n    \"name_chs\": \"地和\",\n    \"name_jp\": \"地和\",\n    \"name_en\": \"Blessing of Earth\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 360,\n    \"sound\": \"fan_dihu\",\n    \"is_guyi\": 0\n  },\n  \"37\": {\n    \"id\": 37,\n    \"name_chs\": \"大三元\",\n    \"name_jp\": \"大三元\",\n    \"name_en\": \"Big Three Dragons\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 370,\n    \"sound\": \"fan_dasanyuan\",\n    \"is_guyi\": 0\n  },\n  \"38\": {\n    \"id\": 38,\n    \"name_chs\": \"四暗刻\",\n    \"name_jp\": \"四暗刻\",\n    \"name_en\": \"Four Concealed Triplets\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 380,\n    \"sound\": \"fan_sianke\",\n    \"is_guyi\": 0\n  },\n  \"39\": {\n    \"id\": 39,\n    \"name_chs\": \"字一色\",\n    \"name_jp\": \"字一色\",\n    \"name_en\": \"All Honors\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 390,\n    \"sound\": \"fan_ziyise\",\n    \"is_guyi\": 0\n  },\n  \"40\": {\n    \"id\": 40,\n    \"name_chs\": \"绿一色\",\n    \"name_jp\": \"緑一色\",\n    \"name_en\": \"All Green\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 400,\n    \"sound\": \"fan_lvyise\",\n    \"is_guyi\": 0\n  },\n  \"41\": {\n    \"id\": 41,\n    \"name_chs\": \"清老头\",\n    \"name_jp\": \"清老頭\",\n    \"name_en\": \"All Terminals\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 410,\n    \"sound\": \"fan_qinglaotou\",\n    \"is_guyi\": 0\n  },\n  \"42\": {\n    \"id\": 42,\n    \"name_chs\": \"国士无双\",\n    \"name_jp\": \"国士無双\",\n    \"name_en\": \"Thirteen Orphans\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 420,\n    \"sound\": \"fan_guoshiwushuang\",\n    \"is_guyi\": 0\n  },\n  \"43\": {\n    \"id\": 43,\n    \"name_chs\": \"小四喜\",\n    \"name_jp\": \"小四喜\",\n    \"name_en\": \"Four Little Winds\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 430,\n    \"sound\": \"fan_xiaosixi\",\n    \"is_guyi\": 0\n  },\n  \"44\": {\n    \"id\": 44,\n    \"name_chs\": \"四杠子\",\n    \"name_jp\": \"四槓子\",\n    \"name_en\": \"Four Quads\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 440,\n    \"sound\": \"fan_sigangzi\",\n    \"is_guyi\": 0\n  },\n  \"45\": {\n    \"id\": 45,\n    \"name_chs\": \"九莲宝灯\",\n    \"name_jp\": \"九蓮宝燈\",\n    \"name_en\": \"Nine Gates\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 450,\n    \"sound\": \"fan_jiulianbaodeng\",\n    \"is_guyi\": 0\n  },\n  \"46\": {\n    \"id\": 46,\n    \"name_chs\": \"八连庄\",\n    \"name_jp\": \"八連荘\",\n    \"name_en\": \"Eight-time East Staying\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 460,\n    \"sound\": \"\",\n    \"is_guyi\": 0\n  },\n  \"47\": {\n    \"id\": 47,\n    \"name_chs\": \"纯正九莲宝灯\",\n    \"name_jp\": \"純正九蓮宝燈\",\n    \"name_en\": \"True Nine Gates\",\n    \"xuanshang\": 0,\n    \"yiman\": 2,\n    \"fan_menqing\": 26,\n    \"fan_fulu\": 26,\n    \"show_index\": 470,\n    \"sound\": \"fan_chunzhengjiulianbaodeng\",\n    \"is_guyi\": 0\n  },\n  \"48\": {\n    \"id\": 48,\n    \"name_chs\": \"四暗刻单骑\",\n    \"name_jp\": \"四暗刻単騎\",\n    \"name_en\": \"Single-wait Four Concealed Triplets\",\n    \"xuanshang\": 0,\n    \"yiman\": 2,\n    \"fan_menqing\": 26,\n    \"fan_fulu\": 26,\n    \"show_index\": 480,\n    \"sound\": \"fan_siankedanqi\",\n    \"is_guyi\": 0\n  },\n  \"49\": {\n    \"id\": 49,\n    \"name_chs\": \"国士无双十三面\",\n    \"name_jp\": \"国士無双十三面待ち\",\n    \"name_en\": \"Thirteen-wait Thirteen Orphans\",\n    \"xuanshang\": 0,\n    \"yiman\": 2,\n    \"fan_menqing\": 26,\n    \"fan_fulu\": 26,\n    \"show_index\": 490,\n    \"sound\": \"fan_guoshishisanmian\",\n    \"is_guyi\": 0\n  },\n  \"50\": {\n    \"id\": 50,\n    \"name_chs\": \"大四喜\",\n    \"name_jp\": \"大四喜\",\n    \"name_en\": \"Four Big Winds\",\n    \"xuanshang\": 0,\n    \"yiman\": 2,\n    \"fan_menqing\": 26,\n    \"fan_fulu\": 26,\n    \"show_index\": 500,\n    \"sound\": \"fan_dasixi\",\n    \"is_guyi\": 0\n  },\n  \"51\": {\n    \"id\": 51,\n    \"name_chs\": \"燕返\",\n    \"name_jp\": \"燕返し\",\n    \"name_en\": \"Tsubame-gaeshi\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 11,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"52\": {\n    \"id\": 52,\n    \"name_chs\": \"杠振\",\n    \"name_jp\": \"槓振り\",\n    \"name_en\": \"Kanburi\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 12,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"53\": {\n    \"id\": 53,\n    \"name_chs\": \"十二落抬\",\n    \"name_jp\": \"十二落抬\",\n    \"name_en\": \"Shiiaruraotai\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 1,\n    \"fan_fulu\": 1,\n    \"show_index\": 13,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"54\": {\n    \"id\": 54,\n    \"name_chs\": \"五门齐\",\n    \"name_jp\": \"五門斉\",\n    \"name_en\": \"Uumensai\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 2,\n    \"show_index\": 293,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"55\": {\n    \"id\": 55,\n    \"name_chs\": \"三连刻\",\n    \"name_jp\": \"三連刻\",\n    \"name_en\": \"Three Chained Triplets\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 2,\n    \"fan_fulu\": 2,\n    \"show_index\": 291,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"56\": {\n    \"id\": 56,\n    \"name_chs\": \"一色三同顺\",\n    \"name_jp\": \"一色三順\",\n    \"name_en\": \"Pure Triple Chow\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 3,\n    \"fan_fulu\": 2,\n    \"show_index\": 292,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"57\": {\n    \"id\": 57,\n    \"name_chs\": \"一筒摸月\",\n    \"name_jp\": \"一筒摸月\",\n    \"name_en\": \"Iipinmoyue\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 5,\n    \"fan_fulu\": 5,\n    \"show_index\": 301,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"58\": {\n    \"id\": 58,\n    \"name_chs\": \"九筒捞鱼\",\n    \"name_jp\": \"九筒撈魚\",\n    \"name_en\": \"Chuupinraoyui\",\n    \"xuanshang\": 0,\n    \"yiman\": 0,\n    \"fan_menqing\": 5,\n    \"fan_fulu\": 5,\n    \"show_index\": 302,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"59\": {\n    \"id\": 59,\n    \"name_chs\": \"人和\",\n    \"name_jp\": \"人和\",\n    \"name_en\": \"Hand of Man\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 590,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"60\": {\n    \"id\": 60,\n    \"name_chs\": \"大车轮\",\n    \"name_jp\": \"大車輪\",\n    \"name_en\": \"Big Wheels\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 600,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"61\": {\n    \"id\": 61,\n    \"name_chs\": \"大竹林\",\n    \"name_jp\": \"大竹林\",\n    \"name_en\": \"Bamboo Forest\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 610,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"62\": {\n    \"id\": 62,\n    \"name_chs\": \"大数邻\",\n    \"name_jp\": \"大数隣\",\n    \"name_en\": \"Numerous Neighbours\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 620,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"63\": {\n    \"id\": 63,\n    \"name_chs\": \"石上三年\",\n    \"name_jp\": \"石の上にも三年\",\n    \"name_en\": \"Ishinouenimosannen\",\n    \"xuanshang\": 0,\n    \"yiman\": 1,\n    \"fan_menqing\": 13,\n    \"fan_fulu\": 13,\n    \"show_index\": 630,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  },\n  \"64\": {\n    \"id\": 64,\n    \"name_chs\": \"大七星\",\n    \"name_jp\": \"大七星\",\n    \"name_en\": \"Big Seven Stars\",\n    \"xuanshang\": 0,\n    \"yiman\": 2,\n    \"fan_menqing\": 26,\n    \"fan_fulu\": 26,\n    \"show_index\": 640,\n    \"sound\": \"\",\n    \"is_guyi\": 1\n  }\n}",
      "transform_game": "module.exports = function (raw) {\n\treturn {\n\t\t_id: raw._id,\n\t\tmodeId: raw.config.meta.mode_id,\n\t\tuuid: raw.uuid,\n\t\tstartTime: raw.start_time,\n\t\tendTime: raw.end_time,\n\t\tplayers: raw.accounts.map(function (account) {\n\t\t\tvar level = raw.result.players.length > 3 ? account.level : account.level3;\n\t\t\tvar playerResult = raw.result.players.filter(function (x) {\n\t\t\t\treturn x.seat === account.seat;\n\t\t\t})[0];\n\t\t\treturn {\n\t\t\t\taccountId: account.account_id,\n\t\t\t\tnickname: account.nickname,\n\t\t\t\tlevel: level.id,\n\t\t\t\tscore: playerResult.part_point_1,\n\t\t\t\tgradingScore: playerResult.grading_score\n\t\t\t};\n\t\t})\n\t};\n};",
      "build_fans": "module.exports = function (fans) {\n\tvar fanDef = require(\"views/lib/fan\");\n\tif (!fans || !fans.forEach) {\n\t\tthrow {\"error\": \"render_error\", \"reason\": toJSON(fans), \"field\": \"fans\"}\n\t}\n\tvar fanMap = {};\n\tfans.forEach(function(x) {\n\t\tif (!fanMap[x]) {\n\t\t\tfanMap[x] = {\n\t\t\t\tid: x,\n\t\t\t\tlabel: fanDef[x].name_chs,\n\t\t\t\tcount: 0,\n\t\t\t\t役满: fanDef[x].yiman,\n\t\t\t};\n\t\t}\n\t\tfanMap[x].count++;\n\t});\n\tvar fanList = Object.keys(fanMap).map(function(x) { return fanMap[x]; });\n\tfanList.sort(function(a, b) {\n\t\treturn fanDef[a.id].show_index - fanDef[b.id].show_index;\n\t});\n\treturn fanList;\n};"
    }
  },
  "lists": {
    "result": "function (head, req) {\n\tvar transform = function (row) {\n\t\treturn toJSON(row.value);\n\t};\n\tvar row = getRow();\n\tif (!row) {\n\t\treq.query.maxage = 60;\n\t}\n\n\tif (req.query.single) {\n\t\tstart({\n\t\t\tstop: true,\n\t\t\tcode: row ? 200 : 404,\n\t\t\theaders: {\n\t\t\t\t\"Cache-Control\": \"public, max-age=\" + (row ? (req.query.maxage || 60) : 3600),\n\t\t\t\t\"Vary\": \"Origin\"\n\t\t\t}\n\t\t});\n\t\tif (!row) {\n\t\t\treturn toJSON({error: \"id_not_found\"});\n\t\t}\n\t\treturn transform(row);\n\t}\n\tstart({\n\t\theaders: {\n\t\t\t\"Cache-Control\": \"public, max-age=\" + (req.query.maxage || 60),\n\t\t\t\"Vary\": \"Origin\"\n\t\t}\n\t});\n\tvar resp = [];\n\tif (row) {\n\t\tresp.push(row.value);\n\t\twhile (row = getRow()) {\n\t\t\tresp.push(row.value);\n\t\t}\n\t}\n\treturn toJSON(resp);\n}",
    "single_value": "function (head, req) {\n\tvar row = getRow();\n\tif (!row) {\n\t\tif (req.query.default) {\n\t\t\tstart({\n\t\t\t\theaders: {\n\t\t\t\t\t\"Cache-Control\": \"public, max-age=\" + (req.query.maxage || 60),\n\t\t\t\t\t\"Vary\": \"Origin\"\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn req.query.default;\n\t\t}\n\t\tstart({\n\t\t\tcode: 404,\n\t\t\theaders: {\n\t\t\t\t\"Cache-Control\": \"public, max-age=3600\",\n\t\t\t\t\"Vary\": \"Origin\"\n\t\t\t}\n\t\t});\n\t\treturn toJSON({error: \"not_found\"});\n\t}\n\tstart({\n\t\theaders: {\n\t\t\t\"Cache-Control\": \"public, max-age=\" + (req.query.maxage || 60),\n\t\t  \"Vary\": \"Origin\"\n\t\t}\n\t});\n\treturn toJSON(row.value);\n}",
    "player_stats": "function (head, req) {\n  var r = require(\"views/lib/resp_utils\");\n\tvar row = getRow();\n\tif (!row) {\n\t\treturn r.error({error: \"id_not_found\"}, 3600, 404);\n\t}\n\tif (!row.key || row.key.length < 1) {\n\t\treturn r.error({error: \"invalid_grouping\"}, 86400);\n\t}\n\tr.start_response(req);\n\tvar result = require(\"views/lib/player_stats\").func(row.value);\n\tresult.id = row.key[0];\n\tresult.nickname = row.value.nickname;\n\treturn toJSON(result);\n}",
    "result_from_doc": "function(head, req) {\n\tvar transform = require(\"views/lib/transform_game\");\n\tvar row = getRow();\n\tif (!row) {\n\t\treq.query.maxage = 60;\n\t}\n\tif (req.query.single) {\n\t\tstart({\n\t\t\tstop: true,\n\t\t\tcode: row ? 200 : 404,\n\t\t\theaders: {\n\t\t\t\t\"Cache-Control\": \"public, max-age=\" + (row ? (req.query.maxage || 60) : 3600),\n\t\t\t\t\"Vary\": \"Origin\"\n\t\t\t}\n\t\t});\n\t\tif (!row) {\n\t\t\treturn toJSON({\n\t\t\t\terror: \"id_not_found\"\n\t\t\t});\n\t\t}\n\t\treturn toJSON(row.doc ? transform(row.doc) : row.value);\n\t}\n\tstart({\n\t\theaders: {\n\t\t\t\"Cache-Control\": \"public, max-age=\" + (req.query.maxage || 60),\n\t\t\t\"Vary\": \"Origin\"\n\t\t}\n\t});\n\tvar resp = [];\n\tif (row) {\n\t\tresp.push(row.doc ? transform(row.doc) : row.value);\n\t\twhile (row = getRow()) {\n\t\t\tresp.push(row.doc ? transform(row.doc) : row.value);\n\t\t}\n\t}\n\treturn toJSON(resp);\n}",
    "search_player": "function (head, req) {\n\tvar transform = function (row) {\n\t  row.value.level = {\n\t\t\tid: row.value.level[0],\n\t\t\tscore: row.value.level[1],\n\t\t\tdelta: row.value.level[2],\n\t\t};\n\t\treturn row.value;\n\t};\n\tvar row = getRow();\n\tif (!row) {\n\t\treq.query.maxage = 60;\n\t}\n\n\tif (req.query.single) {\n\t\tstart({\n\t\t\tstop: true,\n\t\t\tcode: row ? 200 : 404,\n\t\t\theaders: {\n\t\t\t\t\"Cache-Control\": \"public, max-age=\" + (row ? (req.query.maxage || 60) : 3600),\n\t\t\t\t\"Vary\": \"Origin\"\n\t\t\t}\n\t\t});\n\t\tif (!row) {\n\t\t\treturn toJSON({error: \"id_not_found\"});\n\t\t}\n\t\treturn toJSON(transform(row));\n\t}\n\tstart({\n\t\theaders: {\n\t\t\t\"Cache-Control\": \"public, max-age=\" + (req.query.maxage || 60),\n\t\t\t\"Vary\": \"Origin\"\n\t\t}\n\t});\n\tvar resp = [];\n\tif (row) {\n\t\tresp.push(transform(row));\n\t\twhile (row = getRow()) {\n\t\t\tresp.push(transform(row));\n\t\t}\n\t}\n\treturn toJSON(resp);\n}",
    "player_extended_stats": "function (head, req) {\n\tvar row = getRow();\n\tif (!row) {\n\t\tstart({\n\t\t\tcode: 404,\n\t\t\theaders: {\n\t\t\t\t\"Cache-Control\": \"public, max-age=3600\",\n\t\t\t\t\"Vary\": \"Origin\"\n\t\t\t}\n\t\t});\n\t\treturn toJSON({error: \"id_not_found\"});\n\t}\n\tif (row.key.length < 2) {\n\t\tstart({\n\t\t\tcode: 400,\n\t\t\theaders: {\n\t\t\t\t\"Cache-Control\": \"public, max-age=86400\",\n\t\t\t\t\"Vary\": \"Origin\"\n\t\t\t}\n\t\t});\n\t\treturn toJSON({error: \"invalid_grouping\"});\n\t}\n\tstart({\n\t\theaders: {\n\t\t\t\"Cache-Control\": \"public, max-age=60\",\n\t\t\t\"Vary\": \"Origin\"\n\t\t}\n\t});\n\tvar result = require(\"views/lib/convert_extended_stats\").func(row.value);\n\tresult.id = row.key[0];\n\treturn toJSON(result);\n}",
    "rank_rate_by_seat": "function (head, req) {\n\tvar row = getRow();\n\tif (!row) {\n\t\treq.query.maxage = 60;\n\t}\n\tstart({\n\t\theaders: {\n\t\t\t\"Cache-Control\": \"public, max-age=\" + (req.query.maxage || 60),\n\t\t\t\"Vary\": \"Origin\"\n\t\t}\n\t});\n\tvar resp = [];\n\tif (row) {\n\t\tresp.push([row.key, row.value]);\n\t\twhile (row = getRow()) {\n\t\t\tresp.push([row.key, row.value]);\n\t\t}\n\t}\n\treturn toJSON(resp);\n}",
    "fan_stats": "function (head, req) {\n\t\"use strict\";\n  var r = require(\"views/lib/resp_utils\");\n  var fan = require(\"views/lib/fan\");\n\treturn r.reduce_rows(req, function(row, state) {\n\t\tvar mode = row.key[0];\n\t\tstate[mode] = state[mode] || { entries: {} };\n\t\tvar id = row.key[1];\n\t\tif (id < 0) {\n\t\t\tstate[mode].count = row.value;\n\t\t} else {\n\t\t\tstate[mode].entries[id] = {\n\t\t\t\tlabel: fan[id].name_chs,\n\t\t\t\tsort: fan[id].show_index,\n\t\t\t\tcount: row.value,\n\t\t\t};\n\t\t}\n\t\treturn state;\n\t}, function(state) {\n\t\tconst allTypes = {};\n\t\tObject.keys(state).forEach(function(mode) {\n\t\t\tif (!state[mode].entries) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tObject.keys(state[mode].entries).forEach(function(id) {\n\t\t\t\tallTypes[id] = state[mode].entries[id];\n\t\t\t});\n\t\t});\n\t\tObject.keys(state).forEach(function(mode) {\n\t\t\tif (mode.toString() !== \"0\") {\n\t\t\t\tObject.keys(allTypes).forEach(function(id) {\n\t\t\t\t\tif (!state[mode].entries[id]) {\n\t\t\t\t\t\tstate[mode].entries[id] = {\n\t\t\t\t\t\t\tcount: 0,\n\t\t\t\t\t\t\tlabel: allTypes[id].label,\n\t\t\t\t\t\t\tsort: allTypes[id].sort,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tObject.keys(state).forEach(function(mode) {\n\t\t\tvar entries = Object.keys(state[mode].entries).map(function(x) { return state[mode].entries[x]; });\n\t\t\tentries.sort(function(a, b) { return a.sort - b.sort; });\n\t\t\tentries.forEach(function(x) { delete x.sort; });\n\t\t\tstate[mode].entries = entries;\n\t\t});\n\t\treturn state;\n\t}, {}, function(key) {\n\t\tif (!key || key.length < 2) {\n\t\t\treturn r.error({error: \"invalid_grouping\"}, 86400);\n\t\t}\n\t});\n}",
    "highlight_games": "function (head, req) {\n\t\"use strict\";\n  var r = require(\"views/lib/resp_utils\");\n  var transform_game = require(\"views/lib/transform_game\");\n\tvar buildFans = require(\"views/lib/build_fans\");\n\treturn r.reduce_rows(req, function(row, state) {\n\t\trow.value.events.forEach(function(event) {\n\t\t\tvar result = {};\n\t\t\tif (event.type === \"役满\") {\n\t\t\t\tevent.fan = buildFans(event.fan);\n\t\t\t}\n\t\t\tresult._id = row.id.replace(\"r-\", \"\");\n\t\t\tresult.event = event;\n\t\t\tstate.push(result);\n\t\t});\n\t\treturn state;\n\t}, function(state) {\n\t\treturn state;\n\t}, []);\n}"
  },
  "shows": {
    "player_delta_ranking": "function(doc, req) {\n\tvar result = {};\n\tvar mapLevel = function(rawLevel) {\n\t\treturn {\n\t\t\tid: rawLevel[0],\n\t\t\tscore: rawLevel[1],\n\t\t\tdelta: rawLevel[2],\n\t\t};\n\t};\n\t(doc.data || []).forEach(function(row) {\n\t\tresult[row.key[0]] = {\n\t\t\tbottom: row.value.results.slice(0, Math.min(10, Math.floor(row.value.results.length / 2))).filter(function(x) { return x.delta < 0; }),\n\t\t\ttop: row.value.results.slice(Math.max(row.value.results.length - 10, Math.ceil(row.value.results.length / 2))).filter(function(x) { return x.delta > 0; })\n\t\t};\n\t\tresult[row.key[0]].top.sort(function(a, b) { return b.delta - a.delta; });\n\t\tresult[row.key[0]].top.concat(result[row.key[0]].bottom).forEach(function(x) {\n\t\t\tx.level = mapLevel(x.level);\n\t\t});\n\t});\n  return {\n    body : toJSON(result),\n    headers : {\n\t\t\t\"Cache-Control\": \"public, max-age=300\",\n\t\t\t\"Vary\": \"Origin\",\n      \"Content-Type\" : \"application/json; charset=utf-8\"\n    }\n  }\n}",
    "career_ranking": "function(doc, req) {\n\tvar convertExtendedStats = require(\"views/lib/convert_extended_stats\").func;\n\tvar playerStats = require(\"views/lib/player_stats\").func;\n\tvar mapLevel = require(\"views/lib/convert_level\").func;\n\tvar result = doc.data[req.query.mode || \"0\"] || [];\n\tresult = result.map(function(x) {\n\t\tvar r = playerStats(x);\n\t\tr.extended_stats = convertExtendedStats(x.extended);\n\t\tr.count = x.count;\n\t\tr.rank_key = x.rank_key;\n\t\tr.id = x.id;\n\t\tr.nickname = x.nickname;\n\t\treturn r;\n\t});\n  return {\n    body : toJSON(result),\n    headers : {\n\t\t\t\"Cache-Control\": \"public, max-age=3600\",\n\t\t\t\"Vary\": \"Origin\",\n      \"Content-Type\" : \"application/json; charset=utf-8\"\n    }\n  }\n}",
    "generic_data": "function(doc, req) {\n  return {\n    body : toJSON(doc.data),\n    headers : {\n\t\t\t\"Cache-Control\": \"public, max-age=300\",\n\t\t\t\"Vary\": \"Origin\",\n      \"Content-Type\" : \"application/json; charset=utf-8\"\n    }\n  }\n}",
    "global_statistics": "function(doc, req) {\n  var r = require(\"views/lib/resp_utils\");\n\tif (doc.type !== \"globalStatistics\") {\n\t\treturn r.build_response(null, {error: \"invalid_doc\"}, 60, 500);\n\t}\n  var player_stats = require(\"views/lib/player_stats\").func;\n  var convert_extended_stats = require(\"views/lib/convert_extended_stats\").func;\n\tvar data = doc.data;\n\tObject.keys(data).forEach(function(modeKey) {\n\t\tvar levels = data[modeKey];\n\t\tObject.keys(levels).forEach(function(levelKey) {\n\t\t\tvar raw = levels[levelKey];\n\t\t\tdelete raw.最近大铳;\n\t\t\tlevels[levelKey] = {\n\t\t\t\tnum_players: raw.num_players,\n\t\t\t\tbasic: player_stats(raw),\n\t\t\t\textended: convert_extended_stats(raw),\n\t\t\t};\n\t\t});\n\t});\n\treturn r.build_response(req, data, 3600);\n}"
  }
}